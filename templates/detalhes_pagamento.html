<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comprovante de Pagamento - Águas de Santa Maria</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Estilos otimizados para impressão em A4 */
      :root {
        --primary: #0d6efd;
        --success: #198754;
        --danger: #dc3545;
        --warning: #ffc107;
        --gray: #6c757d;
        --light-gray: #e9ecef;
      }

      body {
        font-family: Arial, sans-serif;
        font-size: 10pt;
        line-height: 1.3;
        color: #000;
      }

      .a4-container {
        width: 210mm;
        min-height: 297mm;
        margin: 0 auto;
        padding: 10mm;
      }

      .header {
        text-align: center;
        margin-bottom: 5mm;
        padding-bottom: 3mm;
        border-bottom: 2px solid var(--primary);
      }

      .header h1 {
        font-size: 14pt;
        font-weight: bold;
        color: var(--primary);
        margin: 0;
      }

      .header p {
        font-size: 10pt;
        margin: 2px 0 0;
      }

      .section {
        margin-bottom: 4mm;
        page-break-inside: avoid;
      }

      .section-title {
        font-size: 9pt;
        font-weight: bold;
        background-color: #f5f5f5;
        padding: 2mm;
        border-left: 3px solid var(--primary);
        margin-bottom: 2mm;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2mm 5mm;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
      }

      .label {
        font-weight: bold;
        color: var(--gray);
        flex: 1;
        font-size: 8pt;
      }

      .value {
        flex: 1;
        text-align: right;
        font-size: 9pt;
      }

      .currency {
        font-family: "Courier New", monospace;
      }

      .total-box {
        border: 1px solid var(--light-gray);
        padding: 3mm;
        text-align: center;
        margin: 5mm 0;
        background-color: #f8f9fa;
      }

      .total-label {
        font-size: 9pt;
        font-weight: bold;
        text-transform: uppercase;
      }

      .total-value {
        font-size: 16pt;
        font-weight: bold;
        color: var(--success);
        margin: 2mm 0;
        font-family: "Courier New", monospace;
      }

      .status {
        font-weight: bold;
        font-size: 10pt;
      }

      .footer {
        font-size: 8pt;
        text-align: center;
        margin-top: 5mm;
        padding-top: 3mm;
        border-top: 1px solid var(--light-gray);
      }

      .action-buttons {
        display: none;
      }

      @media screen {
        body {
          background-color: #f5f5f5;
          padding: 10px;
        }

        .a4-container {
          background: white;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          margin-bottom: 20px;
        }

        .action-buttons {
          display: flex;
          justify-content: center;
          gap: 10px;
          margin-top: 15px;
        }

        .btn {
          padding: 5px 15px;
          font-size: 12px;
        }
      }

      @media print {
        @page {
          size: A4;
          margin: 0;
        }

        body {
          background: white;
        }

        .no-print {
          display: none !important;
        }

        .a4-container {
          padding: 10mm;
          width: 210mm;
          min-height: 297mm;
          margin: 0;
          box-shadow: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="a4-container">
      <!-- Cabeçalho -->
      <div class="header">
        <h1>ÁGUAS DE SANTA MARIA</h1>
        <p>COMPROVANTE DE PAGAMENTO</p>
      </div>

      <!-- Seção 1: Dados do Pagamento -->
      <div class="section">
        <div class="section-title">DADOS DO PAGAMENTO</div>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Fatura Referência:</span>
            <span class="value">#{{ leitura.id }}</span>
          </div>
          <div class="info-item">
            <span class="label">Data Pagamento:</span>
            <span class="value">{{ data_emissao }}</span>
          </div>
          <div class="info-item">
            <span class="label">Forma de Pagamento:</span>
            <span class="value"
              >{{ pagamentos_feitos[0].forma_pagamento if pagamentos_feitos else
              'N/A' }}</span
            >
          </div>
          <div class="info-item">
            <span class="label">Valor Pago:</span>
            <span class="value currency text-success"
              >R$ {{ "%.2f"|format(total_pago_acumulado|float) | replace('.',
              ',') }}</span
            >
          </div>
        </div>
      </div>

      <!-- Seção 2: Dados do Consumidor -->
      <div class="section">
        <div class="section-title">DADOS DO CONSUMIDOR</div>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Nome:</span>
            <span class="value">{{ leitura.consumidor_nome }}</span>
          </div>
          <div class="info-item">
            <span class="label">Hidrômetro:</span>
            <span class="value">{{ leitura.hidrometro or "N/C" }}</span>
          </div>
          <div class="info-item">
            <span class="label">Endereço:</span>
            <span class="value"
              >{{ leitura.consumidor_endereco or "Não informado" }}</span
            >
          </div>
          <div class="info-item">
            <span class="label">Telefone:</span>
            <span class="value">{{ leitura.telefone or "Não informado" }}</span>
          </div>
        </div>
      </div>

      <!-- Seção 3: Informações da Fatura -->
      <div class="section">
        <div class="section-title">INFORMAÇÕES DA FATURA</div>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Competência:</span>
            <span class="value"
              >{{ leitura.data_leitura_atual.strftime('%m/%Y') }}</span
            >
          </div>
          <div class="info-item">
            <span class="label">Período Consumo:</span>
            <span class="value">{{ periodo_consumo }}</span>
          </div>
          <div class="info-item">
            <span class="label">Consumo (m³):</span>
            <span class="value">{{ "%g"|format(consumo_m3|int) }} m³</span>
          </div>
          <div class="info-item">
            <span class="label">Vencimento:</span>
            <span class="value">{{ vencimento_formatado }}</span>
          </div>
        </div>
      </div>

      <!-- Seção 4: Resumo Financeiro -->
      <div class="section">
        <div class="section-title">RESUMO FINANCEIRO</div>
        <div style="margin-bottom: 3mm">
          <div class="info-item">
            <span class="label">Valor Original:</span>
            <span class="value currency"
              >R$ {{ "%.2f"|format(leitura.valor_original|float) | replace('.',
              ',') }}</span
            >
          </div>
          {% if total_juros_multa_pago > 0 %}
          <div class="info-item">
            <span class="label">Juros/Multas Pagos:</span>
            <span class="value currency"
              >R$ {{ "%.2f"|format(total_juros_multa_pago|float) | replace('.',
              ',') }}</span
            >
          </div>
          {% endif %} {% if multa_atual > 0 or juros_atual > 0 %}
          <div class="info-item">
            <span class="label">Multas/Juros Pendentes:</span>
            <span class="value currency text-danger"
              >R$ {{ "%.2f"|format(multa_atual + juros_atual|float) |
              replace('.', ',') }}</span
            >
          </div>
          {% endif %}
        </div>

        <div
          class="info-item"
          style="border-top: 1px solid var(--light-gray); padding-top: 2mm"
        >
          <span class="label">Saldo Remanescente:</span>
          <span
            class="value currency {% if saldo_final > 0 %}text-danger{% else %}text-success{% endif %}"
          >
            R$ {{ "%.2f"|format(saldo_final|float) | replace('.', ',') }}
          </span>
        </div>

        <div class="info-item" style="margin-top: 2mm">
          <span class="label">Status:</span>
          <span
            class="value {% if 'Quitada' in situacao_da_fatura_texto %}text-success{% elif 'Vencida' in situacao_da_fatura_texto %}text-danger{% else %}text-warning{% endif %}"
          >
            {{ situacao_da_fatura_texto }}
          </span>
        </div>
      </div>

      <!-- Total Pago -->
      <div class="total-box">
        <div class="total-label">Valor Total Pago</div>
        <div class="total-value">
          R$ {{ "%.2f"|format(total_pago_acumulado|float) | replace('.', ',') }}
        </div>
        <div style="font-size: 9pt">Registrado em: {{ data_emissao }}</div>
        <div
          class="status {% if 'Quitada' in situacao_da_fatura_texto %}text-success{% elif 'Vencida' in situacao_da_fatura_texto %}text-danger{% else %}text-warning{% endif %}"
        >
          {{ situacao_da_fatura_texto }}
        </div>
      </div>

      <!-- Rodapé -->
      <div class="footer">
        <p>
          Este comprovante é válido como prova de pagamento da fatura indicada.
        </p>
        <p>
          Para dúvidas ou informações adicionais, entre em contato com a Águas
          de Santa Maria.
        </p>
      </div>
    </div>

    <!-- Botões de Ação (não aparecem na impressão) -->
    <div class="action-buttons no-print">
      <a href="{{ url_for('listar_pagamentos') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Voltar
      </a>
      <button onclick="window.print()" class="btn btn-primary">
        <i class="fas fa-print"></i> Imprimir
      </button>
      <button onclick="downloadPDF()" class="btn btn-success">
        <i class="fas fa-download"></i> Baixar PDF
      </button>
      {% if whatsapp_phone_number and whatsapp_message %}
      <a
        href="https://wa.me/{{ whatsapp_phone_number }}?text={{ whatsapp_message }}"
        target="_blank"
        class="btn btn-success"
      >
        <i class="fab fa-whatsapp"></i> WhatsApp
      </a>
      {% endif %}
    </div>

    <!-- Incluindo Font Awesome apenas para os ícones dos botões -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <script>
      // Função para baixar como PDF (usando a funcionalidade de impressão do navegador)
      function downloadPDF() {
        window.print();
      }

      // Ou, se preferir usar uma biblioteca específica para PDF:
      /*
        function downloadPDF() {
            // Requer a inclusão da biblioteca html2pdf.js
            const element = document.querySelector('.a4-container');
            const opt = {
                margin: 10,
                filename: 'comprovante-pagamento-aguas-santa-maria.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }
        */
    </script>

    <!-- Se for usar html2pdf.js, descomente a linha abaixo -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> -->
  </body>
</html>
