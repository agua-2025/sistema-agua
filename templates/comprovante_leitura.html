<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Comprovante de Leitura - Águas de Santa Maria</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Mono&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Roboto", sans-serif;
        background-color: #f8f9fa;
      }
      .receipt-container {
        max-width: 800px;
        margin: 2rem auto;
        background: #fff;
        border: 1px solid #dee2e6;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }
      .receipt-header {
        background: linear-gradient(135deg, #0d6efd, #052c65);
        color: white;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
      }
      .comprovante-logo {
        max-height: 45px;
        width: auto;
      }
      .header-text {
        text-align: left;
      }
      .header-text h2,
      .header-text p {
        margin: 0;
        font-weight: 700;
      }
      .receipt-header h2 {
        font-size: 1.8rem;
      }
      .receipt-body {
        padding: 2rem;
      }
      .section-block {
        background-color: #ffffff;
        border: 1px solid #e9ecef;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
      }
      .section-title {
        font-weight: 700;
        color: #495057;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #dee2e6;
        font-size: 1rem;
      }
      .info-item .label {
        display: block;
        font-size: 0.8rem;
        color: #6c757d;
        font-weight: 500;
        text-transform: uppercase;
      }
      .info-item .value {
        font-size: 1rem;
        font-weight: 700;
        color: #212529;
      }
      .photo-section {
        text-align: center;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        padding: 1rem;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        width: 100%;
        height: 300px;
        overflow: hidden;
        position: relative;
      }
      .photo-section img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 0.25rem;
      }
      .photo-section .no-photo-text {
        margin: auto;
        color: #6c757d;
      }
      .buttons {
        padding: 2rem;
        text-align: center;
        display: flex;
        justify-content: center;
        gap: 10px;
      }
      @media print {
        @page {
          size: A4;
          margin: 10mm;
        }
        body {
          background-color: #fff;
          font-size: 8.5pt;
          line-height: 1.25;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        .no-print {
          display: none !important;
        }
        .receipt-container {
          max-width: 100%;
          margin: 0;
          padding: 0;
          box-shadow: none;
          border: none;
        }
        .receipt-header {
          padding: 7mm 0;
          gap: 5px;
        }
        .comprovante-logo {
          max-height: 12mm !important;
        }
        .receipt-header h2 {
          font-size: 14pt;
        }
        .receipt-header p {
          font-size: 9pt;
        }
        .receipt-body {
          padding: 0 5mm;
        }
        .section-block {
          border: 1px solid #eee !important;
          box-shadow: none !important;
          padding: 4mm !important;
          margin-bottom: 3.5mm !important;
          page-break-inside: avoid;
        }
        .section-title {
          font-size: 9pt;
          margin-bottom: 3mm;
          padding-bottom: 2mm;
        }
        .info-item .label {
          font-size: 7pt;
        }
        .info-item .value {
          font-size: 8.5pt;
        }
        .photo-section {
          height: 150px !important;
          padding: 4mm !important;
        }
        .table {
          font-size: 8pt;
          margin-bottom: 1rem !important;
        }
        .table tfoot td {
          font-size: 10pt !important;
        }
        .alert {
          padding: 0.4rem !important;
          font-size: 7pt !important;
          margin-top: 0.5rem !important;
        }
        .buttons {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="receipt-container">
      <header class="receipt-header">
        <svg
          class="comprovante-logo"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 120 80"
        >
          <g>
            <path
              d="M10 50 Q 35 10, 60 50 T 110 50"
              stroke="#FFFFFF"
              stroke-width="12"
              fill="none"
              stroke-linecap="round"
            />
            <path
              d="M10 70 Q 35 30, 60 70 T 110 70"
              stroke="#A9C2FD"
              stroke-width="12"
              fill="none"
              stroke-linecap="round"
            />
            <path
              d="M10 30 Q 35 -10, 60 30 T 110 30"
              stroke="#87A7FF"
              stroke-width="12"
              fill="none"
              stroke-linecap="round"
            />
          </g>
        </svg>
        <div class="header-text">
          <h2>Águas de Santa Maria</h2>
          <p class="mb-0">Comprovante de Leitura</p>
        </div>
      </header>
      <div class="receipt-body">
        <section class="section-block mb-3">
          <h3 class="section-title">Dados da Unidade</h3>
          <div class="row">
            <div class="col-sm-8 info-item mb-2 mb-sm-0">
              <span class="label">CLIENTE</span>
              <span class="value">{{ leitura.consumidor_nome }}</span>
            </div>
            <div class="col-sm-4 info-item">
              <span class="label">FATURA REF.</span>
              <span class="value">#{{ leitura.id }}</span>
            </div>
            <div class="col-12 info-item mt-2">
              <span class="label">ENDEREÇO</span>
              <span class="value">{{ leitura.consumidor_endereco }}</span>
            </div>
          </div>
        </section>

        <div class="row">
          <div class="col-md-7">
            <section class="section-block mb-3 h-100">
              <h3 class="section-title">Informações da Medição</h3>
              <div class="row">
                <div class="col-6">
                  <div class="info-item mb-2">
                    <span class="label">LEITURA ATUAL</span>
                    <span class="value"
                      >{{ "%g"|format(leitura.leitura_atual|int) }} m³</span
                    >
                  </div>
                  <div class="info-item">
                    <span class="label">LEITURA ANTERIOR</span>
                    <span class="value"
                      >{{ "%g"|format(leitura.leitura_anterior|int) }} m³</span
                    >
                  </div>
                </div>
                <div class="col-6">
                  <div class="info-item mb-2">
                    <span class="label">DATA ATUAL</span>
                    <span class="value"
                      >{{ data_leitura_atual_formatada }}</span
                    >
                  </div>
                  <div class="info-item">
                    <span class="label">DATA ANTERIOR</span>
                    <span class="value"
                      >{{ leitura.data_leitura_anterior.strftime('%d/%m/%Y') if
                      leitura.data_leitura_anterior else 'N/A' }}</span
                    >
                  </div>
                </div>
              </div>
              <hr class="my-3" />
              <div class="row">
                <div class="col-sm-5">
                  <div class="info-item">
                    <span class="label">PERÍODO DE CONSUMO</span>
                    <span class="value">{{ periodo_consumo }}</span>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="info-item">
                    <span class="label">DIAS NO PERÍODO</span>
                    <span class="value">{{ dias_no_periodo }}</span>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="info-item">
                    <span class="label">MÉDIA DIÁRIA</span>
                    <span class="value"
                      >{{ "%.3f"|format(media_diaria_consumo|float) |
                      replace('.',',') }} m³</span
                    >
                  </div>
                </div>
              </div>
            </section>
          </div>
          <div class="col-md-5">
            <section class="section-block photo-section mb-3">
              <span class="label d-block text-center mb-1"
                >FOTO DO HIDRÔMETRO</span
              >

              {% if leitura.foto_hidrometro_base64 %}
              <img
                src="{{ leitura.foto_hidrometro_base64 }}"
                alt="Foto do hidrômetro"
              />
              {% elif leitura.foto_hidrometro %}
              <img
                src="{{ url_for('static', filename='fotos_hidrometros/' + leitura.foto_hidrometro) }}"
                alt="Foto do hidrômetro"
              />
              {% else %}
              <div class="no-photo-text">Nenhuma foto foi enviada.</div>
              {% endif %}
            </section>
          </div>
        </div>

        <section class="section-block">
          <h3 class="section-title">Detalhamento da Fatura</h3>
          <table class="table table-sm table-borderless mb-3">
            <tbody>
              <tr>
                <td class="text-muted">Consumo no Período:</td>
                <td class="text-end fw-bold">
                  {{ "%g"|format(consumo_m3|int) }} m³
                </td>
              </tr>
              {% for item in detalhamento_fatura %}
              <tr>
                <td>{{ item.descricao }}</td>
                <td class="text-end">
                  R$ {{ "%.2f"|format(item.valor|float) | replace('.', ',') }}
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="2" class="text-center text-muted fst-italic py-3">
                  Esta é uma leitura informativa, sem valores a faturar.
                </td>
              </tr>
              {% endfor %}
            </tbody>
            {% if leitura.valor_original is not none %}
            <tfoot class="border-top">
              <tr class="fw-bold">
                <td class="fs-6">TOTAL DA FATURA</td>
                <td class="text-end fs-6 text-primary">
                  R$ {{ "%.2f"|format(leitura.valor_original|float) |
                  replace('.', ',') }}
                </td>
              </tr>
            </tfoot>
            {% endif %}
          </table>

          <div class="text-center bg-light p-2 rounded">
            <span class="text-muted text-uppercase small"
              >Data de Vencimento</span
            >
            <div class="fs-6 fw-bold">{{ vencimento_formatado }}</div>
          </div>

          <div class="alert alert-light border p-3 mt-3 small" role="alert">
            <h6 class="alert-heading" style="font-size: 0.9rem">
              <i class="fas fa-exclamation-circle me-2"></i>Aviso Importante
            </h6>
            <hr class="my-2" />
            <p class="mb-1">
              O valor desta fatura é válido para pagamento realizado
              estritamente <strong>até a data de vencimento</strong>.
            </p>
            <p class="mb-0">
              Para pagamentos após o vencimento, o valor será recalculado com
              juros e multa. Por favor, contate a
              <strong>Águas de Santa Maria</strong> para emitir uma nova fatura
              com o valor atualizado.
            </p>
          </div>
        </section>
      </div>

      <div class="buttons no-print">
        <a href="{{ url_for('listar_leituras') }}" class="btn btn-secondary"
          ><i class="fas fa-arrow-left"></i> Voltar</a
        >
        <button onclick="window.print()" class="btn btn-primary">
          <i class="fas fa-print"></i> Gerar PDF
        </button>
        {% if whatsapp_phone_number and whatsapp_phone_number|length > 10 %}
        <a
          href="https://wa.me/{{ whatsapp_phone_number }}?text={{ whatsapp_message }}"
          target="_blank"
          class="btn btn-success"
        >
          <i class="fab fa-whatsapp"></i> Enviar WhatsApp
        </a>
        {% endif %}
      </div>
    </div>
  </body>
</html>
